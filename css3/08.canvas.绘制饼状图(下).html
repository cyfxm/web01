<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>饼状图 数据统计</title>
    <style>
        canvas {
            background-color: #ccc;
        }
    </style>
</head>

<body>

    <canvas id="canvas">不支持canvas标签！</canvas>

    <script>
        // 1.0 获取canvas标签
        var canvas = document.getElementById("canvas");
        // 2.0 设置画布的大小
        canvas.width = 800;
        canvas.height = 800;
        // 3.0 获取canvas上下文对象
        var ctx = canvas.getContext('2d');
        // 4.0 假数据
        var data = [
            { "date": "一月份", "persent": "0.3", "color": "red" },
            { "date": "二月份", "persent": "0.2", "color": "green" },
            { "date": "三月份", "persent": "0.05", "color": "blue" },
            { "date": "四月份", "persent": "0.35", "color": "orange" },
            { "date": "五月份", "persent": "0.1", "color": "purple" }
        ]
        // 绘制饼状图
        // ctx.arc(
        //     x , y   // 圆心坐标
        //     rad, //半径
        //     0 ,  //开始的弧度
        //     360 * Math.PI/180, //结束的弧度
        //     bool // false
        // )

        // 4.0 定义圆心
        var point = { x: 300, y: 300 }
        var rad = 200;

        // 5.0 编写一个函数 绘制弧形
        function drawCircle(start, end, color) {
            ctx.beginPath();
            ctx.moveTo(point.x, point.y);
            ctx.arc(
                point.x, point.y,
                rad,
                start,
                end,
                false
            )
            ctx.fillStyle = color;
            ctx.closePath();
            ctx.fill();
        }
        // 6.0  编写一个函数 绘制线
        function drawLine(x , y){
            ctx.beginPath();
            ctx.strokeStyle="#000";
            ctx.moveTo(point.x , point.y);
            ctx.lineTo(point.x + x , point.y+y);
            ctx.closePath();
            ctx.stroke();
        }
        // *.0 编写一个函数 绘制文本
        function drawText(x,y,text){
            ctx.beginPath();
            ctx.font="20px Microsoft YaHei";
            ctx.textAlign="center";
            ctx.textBaseLine="middle";
            ctx.fillStyle="white";
            ctx.fillText(text,point.x + x ,point.y+y );
            ctx.closePath();
        }
        // drawText(100,100,"hello")

        // JS 是单线程的编程语言  从上往下执行
        // 一月份
        // 7.0 开始的弧度
        var startAngle = 0;
        // 8.0 结束的弧度
        var endAngle = 360 * data[0].persent * Math.PI / 180;
        // 9.0 绘制一月份的弧形
        drawCircle(
            startAngle,
            endAngle,
            data[0].color
        );
        // 10.0 记录一月份的弧度的1/2
        var oneV =  (360 * data[0].persent/2) * Math.PI / 180;
        // 11.0 计算文本的坐标位置
        var x1 =  Math.cos(oneV) * (rad-100);
        var y1 =  Math.sin(oneV) * (rad-100);
        // 12.0 绘制一月份的中间线
        // drawLine(x1,y1);
        // 绘制一月份的文本
        drawText(x1,y1,data[0].date+"占"+(data[0].persent*100)+"%");

        // 二月份
        // 13.0 二月份开始的弧度
        startAngle = endAngle;//表示把上一个endAngle赋值给当前startAngle
        // 14.0 二月份结束的弧度
        endAngle = startAngle + 360 * data[1].persent * Math.PI / 180;
        // 15.0 绘制二月份弧形
        drawCircle(
            startAngle,
            endAngle,
            data[1].color
        );
        // 16.0 记录一月份的弧形结束绘制的位置（弧度）
        var oneEnd = 360 * data[0].persent * Math.PI / 180;
        // 17.0 计算二月份弧度的1/2 加上一月份的结束弧度
        var twoV =  (360 * data[1].persent/2) * Math.PI / 180 + oneEnd;
        // 18.0 计算二月份中间的坐标位置
        var x2=  Math.cos(twoV) * (rad-100);
        var y2 =  Math.sin(twoV) * (rad-100);
        // 19.0 二月份的中间线
        // drawLine(x2,y2);
        // 绘制二月份的文本
        drawText(x2,y2,data[1].persent);



        // 三月份
        // 20.0 记录三月份的开始的弧度
        startAngle = endAngle;
        // 21.0 记录三月份的结束的弧度
        endAngle = startAngle + 360 * data[2].persent * Math.PI / 180
        // 22.0 绘制三月份的弧形
        drawCircle(
            startAngle,
            endAngle,
            data[2].color
        );
        // 24.0 二月份结束的弧形结束绘制的位置（弧度）
        var twoEnd = oneEnd + 360 * data[1].persent * Math.PI / 180;
        // 25.0 三月份的弧度一半 加上二月份结束的弧形结束绘制的位置（弧度）
        var threeV =  (360 * data[2].persent/2) * Math.PI / 180 + twoEnd;
        // 26.0 三月份的中间坐标位置
        var x3=  Math.cos(threeV) * (rad-50);
        var y3 =  Math.sin(threeV) * (rad-50);
        //  27.0 三月份的中间线
        // drawLine(x3,y3);
        // 绘制三月份的文本
        drawText(x3,y3,data[2].persent);

        // 四月份
        // 29.0 记录四月份的开始弧度
        startAngle = endAngle
        // 30.0 记录四月份的结束弧度
        endAngle = startAngle + 360 * data[3].persent * Math.PI / 180
        // 31.0 绘制四月份的弧度
        drawCircle(
            startAngle,
            endAngle,
            data[3].color
        );
     
        // 34.0 记录三月份绘制弧形结束的位置(弧度)
        var threeEnd = twoEnd + 360 * data[2].persent * Math.PI / 180;
        // 35.0 计算四月份弧度的一半加上三月份绘制弧形结束的位置(弧度)
        var fourV =  (360 * data[3].persent/2) * Math.PI / 180 + threeEnd;
        // 36.0 计算四月份的中间坐标位置
        var x4=  Math.cos(fourV) * (rad-100);
        var y4 =  Math.sin(fourV) * (rad-100);
        // 37.0 绘制四月份的中间线
        // drawLine(x4,y4);
        // 绘制四月份的文本
        drawText(x4,y4,data[3].persent);
        
        // 五月份
        // 38.0 记录五月份开始的弧度
        startAngle = endAngle;
        // 39.0 记录五月份结束的弧度
        endAngle = startAngle + 360 * data[4].persent * Math.PI / 180;
        // 40.0 绘制五月份的弧度
        drawCircle(
            startAngle,
            endAngle,
            data[4].color
        );
      
        // 44.0 记录四月份绘制弧形结束的位置(弧度)
        var fourEnd = threeEnd + 360 * data[3].persent * Math.PI / 180;
        // 45.0五月份弧度的一半 加上四月份绘制弧形结束的位置(弧度)
        var fiveV =  (360 * data[4].persent/2) * Math.PI / 180 + fourEnd;
        // 46.0 计算出五月份中间的坐标
        var x5=  Math.cos(fiveV) * (rad-100);
        var y5 =  Math.sin(fiveV) * (rad-100);
        // 47.0 绘制五月份中间线
        // drawLine(x5,y5);
         // 绘制五月份的文本
         drawText(x5,y5,data[4].persent);




    </script>
</body>

</html>